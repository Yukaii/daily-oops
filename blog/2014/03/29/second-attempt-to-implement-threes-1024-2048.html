<!DOCTYPE html><html><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><title>第二篇 - 嘗試實作Threes!/ 1024 /2048 | Daily Oops!</title><meta name="next-head-count" content="3"/><link rel="preload" href="/_next/static/css/45778d60a3644c5341ee.css" as="style"/><link rel="stylesheet" href="/_next/static/css/45778d60a3644c5341ee.css" data-n-g=""/><link rel="preload" href="/_next/static/css/e4258c405de180b72652.css" as="style"/><link rel="stylesheet" href="/_next/static/css/e4258c405de180b72652.css" data-n-g=""/><noscript data-n-css="true"></noscript><link rel="preload" href="/_next/static/chunks/main-2fb41fa543a1e674f096.js" as="script"/><link rel="preload" href="/_next/static/chunks/webpack-e067438c4cf4ef2ef178.js" as="script"/><link rel="preload" href="/_next/static/chunks/framework.9ec1f7868b3e9d138cdd.js" as="script"/><link rel="preload" href="/_next/static/chunks/c1c2800e.19830e50427f38e47434.js" as="script"/><link rel="preload" href="/_next/static/chunks/commons.cb82874e43d6dd0d0fae.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/_app-6f7019f6f5388083710c.js" as="script"/><link rel="preload" href="/_next/static/chunks/0e226fb0.72f93e4cb7021a00e808.js" as="script"/><link rel="preload" href="/_next/static/chunks/9f96d65d.6d2fb2f6923d41a412a8.js" as="script"/><link rel="preload" href="/_next/static/chunks/39029a4f0b0d40d46b79d3315f88da1b7749bd7f.5a43b4f7d2949ffa6f12.js" as="script"/><link rel="preload" href="/_next/static/chunks/35c7c14249a4e2e42e1e799eb48e20c6dd8c6b4d.2bb70c78b7c30f6c9e9d.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/blog/%5Byear%5D/%5Bmonth%5D/%5Bday%5D/%5Bslug%5D-a24c9778d9cc066b0aed.js" as="script"/></head><body><div id="__next"><div><div class="d-block text-center bg-gray py-4 px-1"><div class="CircleBadge CircleBadge--large mx-auto mb-3" style="background-color:#F5CC7F"><img src="/logo-transparent.png" alt="Daily Oops" style="height:auto;max-height:75%;max-width:75%" class="user-select-none"/></div><h1>Daily Oops!</h1></div><nav class="UnderlineNav flex-justify-center bg-gray px-1 position-sticky top-0" style="z-index:1"><div class="UnderlineNav-body" role="tablist"><button class="UnderlineNav-item" role="tab" type="button" aria-selected="false"><svg aria-hidden="true" role="img" class="UnderlineNav-octicon" viewBox="0 0 16 16" width="16" height="16" fill="currentColor" style="display:inline-block;user-select:none;vertical-align:text-bottom"><path fill-rule="evenodd" d="M0 1.75A.75.75 0 01.75 1h4.253c1.227 0 2.317.59 3 1.501A3.744 3.744 0 0111.006 1h4.245a.75.75 0 01.75.75v10.5a.75.75 0 01-.75.75h-4.507a2.25 2.25 0 00-1.591.659l-.622.621a.75.75 0 01-1.06 0l-.622-.621A2.25 2.25 0 005.258 13H.75a.75.75 0 01-.75-.75V1.75zm8.755 3a2.25 2.25 0 012.25-2.25H14.5v9h-3.757c-.71 0-1.4.201-1.992.572l.004-7.322zm-1.504 7.324l.004-5.073-.002-2.253A2.25 2.25 0 005.003 2.5H1.5v9h3.757a3.75 3.75 0 011.994.574z"></path></svg><span>Blog</span></button><button class="UnderlineNav-item" role="tab" type="button" aria-selected="false"><svg aria-hidden="true" role="img" class="UnderlineNav-octicon" viewBox="0 0 16 16" width="16" height="16" fill="currentColor" style="display:inline-block;user-select:none;vertical-align:text-bottom"><path fill-rule="evenodd" d="M4.72 3.22a.75.75 0 011.06 1.06L2.06 8l3.72 3.72a.75.75 0 11-1.06 1.06L.47 8.53a.75.75 0 010-1.06l4.25-4.25zm6.56 0a.75.75 0 10-1.06 1.06L13.94 8l-3.72 3.72a.75.75 0 101.06 1.06l4.25-4.25a.75.75 0 000-1.06l-4.25-4.25z"></path></svg><span>Projects</span></button><button class="UnderlineNav-item" role="tab" type="button" aria-selected="false"><svg aria-hidden="true" role="img" class="UnderlineNav-octicon" viewBox="0 0 16 16" width="16" height="16" fill="currentColor" style="display:inline-block;user-select:none;vertical-align:text-bottom"><path fill-rule="evenodd" d="M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z"></path></svg><span>About</span></button></div></nav><div class="markdown-body container pt-4 pb-6 px-3"><p>不得不提，Logdown自動產生英文網址實在太猛了，不用反觀了沒一個能打的=w=</p>
<p>今天花了一點時間嘗試實作最近 <s>SITCON</s> 很紅的遊戲<a href="https://itunes.apple.com/us/app/threes!/id779157948?mt=8&amp;ign-mpt=uo%3D2">Threes!</a>以及各種衍生 <s>致敬</s> 版本（像<a href="https://itunes.apple.com/us/app/1024!/id823499224">1024</a>啦、<a href="http://gabrielecirulli.github.io/2048/">2048</a>、<a href="http://a0tim.github.io/">服貿2048</a>等等）。雖然一如往常的需要時間Debug，好說歹說也做出一個簡單的樣子了。其實只要搞懂規則，剩下來就看個人造化了。以下由規則切入演算法（大概），來吧。</p>
<!--more-->
<h2>規則</h2>
<p>這幾個遊戲雖然看起來差不多，但規則上其實些微不同，以下便討論他們的不同：</p>
<h3>合併</h3>
<p>最開始讓人注意到的規則就是合併兩個方塊了。在 <a href="https://itunes.apple.com/us/app/threes!/id779157948?mt=8&amp;ign-mpt=uo%3D2"><em>Threes!</em></a> 裡面最基本的組合是<code>1 + 2 = 3</code>而在 <a href="https://itunes.apple.com/us/app/1024!/id823499224"><em>1024</em></a> , <a href="http://gabrielecirulli.github.io/2048/"><em>2048</em></a> 等是由 2的1次方 開始，慢慢組合到 2的N次方。</p>
<p>在方塊合併時其實是由滑動方向作為合併的判斷。我知道這句話說了跟放屁一樣沒啥用。好，來看例子：</p>
<p>以下例子，三個3在同一列，此時往左推，將會造成：</p>
<pre><code>	3 3 3 █  →  6 3 █ █
</code></pre>
<p>而非</p>
<pre><code>	3 3 3 █  →  3 6 █ █
</code></pre>
<p>這說明了在判斷合併時，是由左向右判讀，左邊開始第一個遇到能合併的就先併了：</p>
<pre><code>	3+3 █ 3 █
</code></pre>
<p>再將最右邊的3抓過來：</p>
<pre><code>	6 3 █ █
</code></pre>
<p>但如果是四個同樣的數字呢？這邊的處理方式 <a href="https://itunes.apple.com/us/app/threes!/id779157948?mt=8&amp;ign-mpt=uo%3D2"><em>Threes!</em></a> 和 <a href="http://gabrielecirulli.github.io/2048/"><em>2048</em></a> 就不同了。</p>
<p><a href="https://itunes.apple.com/us/app/threes!/id779157948?mt=8&amp;ign-mpt=uo%3D2"><em>Threes!</em></a> 會左合併一次，變成：</p>
<pre><code>	6 3 3 █
</code></pre>
<p>再次往左消才會變成</p>
<pre><code>	6 6 █ █
</code></pre>
<p>而 <a href="http://gabrielecirulli.github.io/2048/"><em>2048</em></a> 會接「消到底」：</p>
<pre><code>	2 2 2 2 → 4 4 █ █
</code></pre>
<h3>方塊移動</h3>
<p>這和上一個規則類似，在 <a href="https://itunes.apple.com/us/app/threes!/id779157948?mt=8&amp;ign-mpt=uo%3D2"><em>Threes!</em></a> 只會一次移動一格， <a href="http://gabrielecirulli.github.io/2048/"><em>2048</em></a> 相當於「推到底」。</p>
<h3>隨機填補</h3>
<p>其實這個規則還是有些難猜，又還沒翻 <a href="http://gabrielecirulli.github.io/2048/"><em>2048</em></a> 的原始碼，暫且不討論吧XD</p>
<h2>實作</h2>
<p>知道以上的規則大概就寫的出來了。</p>
<p>一直很不熟物件導向的我，嘗試將每個格子設為一個物件，運用類似，<code>Linklist</code>（感謝學長）的方法將每個格子串在一起，類似以下這種寫法：</p>
<pre><code class="language-c++">class Grid{
	Grid* right, left, up, down
}
</code></pre>
<p>這樣在寫合併時，只要從四邊出發，就能沿著路徑偵測合併的情況。</p>
<pre><code>  → → → →
  → → → →
  → → → →
  → → → →
</code></pre>
<p>另外又設定了一個二維陣列來管理遊戲板(board)</p>
<pre><code class="language-c++">Grid board[4][4]
</code></pre>
<p>實作移動、合併等內容。</p>
<p>目前遊戲內容還沒啥營養，純文字介面而已，「有空」套上 <a href="http://www.libsdl.org/">SDL</a>，再加強一下，唉。</p>
<p><img src="http://user-image.logdown.io/user/1128/blog/1112/post/191665/RfwWbqoDSH21fl6E7isW_%E8%9E%A2%E5%B9%95%E6%93%B7%E5%9C%96%E5%AD%98%E7%82%BA%202014-03-29%2021:20:44.png" alt="螢幕擷圖存為 2014-03-29 21:20:44.png"></p>
<h3><a href="https://github.com/Yukaii/my2048">Github</a></h3>
</div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"content":"不得不提，Logdown自動產生英文網址實在太猛了，不用反觀了沒一個能打的=w=\n\n今天花了一點時間嘗試實作最近 ~~SITCON~~ 很紅的遊戲[Threes!][1]以及各種衍生 ~~致敬~~ 版本（像[1024][2]啦、[2048][3]、[服貿2048](http://a0tim.github.io/)等等）。雖然一如往常的需要時間Debug，好說歹說也做出一個簡單的樣子了。其實只要搞懂規則，剩下來就看個人造化了。以下由規則切入演算法（大概），來吧。\n\n\u003c!--more--\u003e\n\n## 規則\n\n這幾個遊戲雖然看起來差不多，但規則上其實些微不同，以下便討論他們的不同：\n\n### 合併\n\n最開始讓人注意到的規則就是合併兩個方塊了。在 [_Threes!_][1] 裡面最基本的組合是`1 + 2 = 3`而在 [_1024_][2] , [_2048_][3] 等是由 2的1次方 開始，慢慢組合到 2的N次方。\n\n在方塊合併時其實是由滑動方向作為合併的判斷。我知道這句話說了跟放屁一樣沒啥用。好，來看例子：\n\n以下例子，三個3在同一列，此時往左推，將會造成：\n\n\t\t3 3 3 █  →  6 3 █ █\n\n而非\n\n\t\t3 3 3 █  →  3 6 █ █\n    \n這說明了在判斷合併時，是由左向右判讀，左邊開始第一個遇到能合併的就先併了：\n\n\t\t3+3 █ 3 █\n    \n再將最右邊的3抓過來：\n\n\t\t6 3 █ █\n    \n但如果是四個同樣的數字呢？這邊的處理方式 [_Threes!_][1] 和 [_2048_][3] 就不同了。\n\n[_Threes!_][1] 會左合併一次，變成：\n\n\t\t6 3 3 █\n    \n再次往左消才會變成\n\n\t\t6 6 █ █\n    \n而 [_2048_][3] 會接「消到底」：\n\t\t\n    \t2 2 2 2 → 4 4 █ █\n\n### 方塊移動\n\n這和上一個規則類似，在 [_Threes!_][1] 只會一次移動一格， [_2048_][3] 相當於「推到底」。\n\t\n### 隨機填補\n\n其實這個規則還是有些難猜，又還沒翻 [_2048_][3] 的原始碼，暫且不討論吧XD\n    \n## 實作\n知道以上的規則大概就寫的出來了。\n\n一直很不熟物件導向的我，嘗試將每個格子設為一個物件，運用類似，`Linklist`（感謝學長）的方法將每個格子串在一起，類似以下這種寫法：\n\n```c++\nclass Grid{\n\tGrid* right, left, up, down\n}\n```\n    \n這樣在寫合併時，只要從四邊出發，就能沿著路徑偵測合併的情況。\n\n      → → → →\n      → → → →\n      → → → →\n      → → → →\n      \n另外又設定了一個二維陣列來管理遊戲板(board)\n\n```c++\nGrid board[4][4]\n```\n\n實作移動、合併等內容。\n\n目前遊戲內容還沒啥營養，純文字介面而已，「有空」套上 [SDL](http://www.libsdl.org/)，再加強一下，唉。\n\n![螢幕擷圖存為 2014-03-29 21:20:44.png](http://user-image.logdown.io/user/1128/blog/1112/post/191665/RfwWbqoDSH21fl6E7isW_%E8%9E%A2%E5%B9%95%E6%93%B7%E5%9C%96%E5%AD%98%E7%82%BA%202014-03-29%2021:20:44.png)\n\n### [Github](https://github.com/Yukaii/my2048)\n\n[1]:https://itunes.apple.com/us/app/threes!/id779157948?mt=8\u0026ign-mpt=uo%3D2\n[2]:https://itunes.apple.com/us/app/1024!/id823499224\n[3]:http://gabrielecirulli.github.io/2048/\n\n\n","title":"第二篇 - 嘗試實作Threes!/ 1024 /2048"},"__N_SSG":true},"page":"/blog/[year]/[month]/[day]/[slug]","query":{"year":"2014","month":"03","day":"29","slug":"second-attempt-to-implement-threes-1024-2048"},"buildId":"tutoquxD9YkhAogUcGXXA","nextExport":false,"isFallback":false,"gsp":true}</script><script nomodule="" src="/_next/static/chunks/polyfills-e5012cf49fbb0a2642db.js"></script><script src="/_next/static/chunks/main-2fb41fa543a1e674f096.js" async=""></script><script src="/_next/static/chunks/webpack-e067438c4cf4ef2ef178.js" async=""></script><script src="/_next/static/chunks/framework.9ec1f7868b3e9d138cdd.js" async=""></script><script src="/_next/static/chunks/c1c2800e.19830e50427f38e47434.js" async=""></script><script src="/_next/static/chunks/commons.cb82874e43d6dd0d0fae.js" async=""></script><script src="/_next/static/chunks/pages/_app-6f7019f6f5388083710c.js" async=""></script><script src="/_next/static/chunks/0e226fb0.72f93e4cb7021a00e808.js" async=""></script><script src="/_next/static/chunks/9f96d65d.6d2fb2f6923d41a412a8.js" async=""></script><script src="/_next/static/chunks/39029a4f0b0d40d46b79d3315f88da1b7749bd7f.5a43b4f7d2949ffa6f12.js" async=""></script><script src="/_next/static/chunks/35c7c14249a4e2e42e1e799eb48e20c6dd8c6b4d.2bb70c78b7c30f6c9e9d.js" async=""></script><script src="/_next/static/chunks/pages/blog/%5Byear%5D/%5Bmonth%5D/%5Bday%5D/%5Bslug%5D-a24c9778d9cc066b0aed.js" async=""></script><script src="/_next/static/tutoquxD9YkhAogUcGXXA/_buildManifest.js" async=""></script><script src="/_next/static/tutoquxD9YkhAogUcGXXA/_ssgManifest.js" async=""></script></body></html>